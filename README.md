# ADISE25_2019131

ΣΥΝΟΠΤΙΚΗ ΠΕΡΙΓΡΑΦΗ PROJECT - ΠΑΙΧΝΙΔΙ ΞΕΡΗΣ

Οι απαιτήσεις του project ήταν η ανάπτυξη μόνο Web API (human - human , χωρίς GUI από CLI(εντολή culr ή wget)). Ωστόσο για την αποφυγή συμφόρησης κατά την παρουσίαση του παιχνιδιού και 
για ευκολία στην παρουσίαση αναπτύχθηκε ένα Dashboard (HTML) όπου μέσω των input fields και  buttons θα γίνεται η 
1) Αυθεντικοποίηση των παικτών
2) Δημιουργία του παιχνιδιού
3) Έλεγχος κατάστασης του παιχνιδιού
4) Εκτέλεση των κινήσεων

Η αυθεντικοποίηση (stateless) των παικτών γίνεται μέσω του endpoint POST /api/v1/auth και με την χρήση PHP δημιουργείται μια τυχαία, μοναδική συμβολοσειρά (string) 32 χαρακτήρων (token) μέσω της συνάρτησης bin2hex(random_bytes(16)).
Το API συνδέεται με την βάση δεδομένων στην MySQL (πίνακας players) και εκτελεί μια εντολή INSERT αποθηκεύοντας με αυτό τον τρόπο το token και η βάση δεδομένων δημιουργεί αυτόματα ένα μοναδικό player_id. Για την επαλήθευση σε κάθε επόμενη κλήση
το API παίρνει το token από το header και ψάχνει στην βάση δεδομένων αν υπάρχει αυτό το token. Σε περίπτωση που υπάρχει, αναγνωρίζει ποιός παίκτης είναι και του επιτρέπει να παίξει, σε διαφορετική περίπτωση επιστρέφει σφάλμα 401 Unauthorized.

Η δημιοργία του παιχνιδιού γίνεται μέσω του endpoint POST /api/v1/games.  Όταν ένας παίκτης θέλει να δημιουργίσει μια νέα παρτίδα το API ελέγχει το Authorization Token που στέλνει ο χρήστης και το αναζητά στον πίνακα players. Αν το βρει
ανακτά το player id του χρήστη και ορίζεται ως player1 (P1). Έπειτα αρχικοποιείται η λογική του παιχνιδιού καλώντας τη συνάρτηση initialize_game() από το αρχείο game_logic.php για την δημιουργία του deck, το ανακάτεμα της τράπουλας,
το μοίρασμα και την κατάσταση του παιχνιδιού. Το API εκτελόντας μια εντολή INSERT αποθηκεύει στον πίνακα games το playerid του παίκτη που έκανε το αίτημα, το game status , το current turn και το board state το οποίο μετατρέπεται σε 
json string 

Στον έλεγχο κατάστασης που παιχνιδιού η διαδικασία εκτελείται μέσω του endpoint GET /api/v1/games/{id}. Επειδή το πρωτόκολλο HTTP είναι "stateless" (δεν κρατάει μόνιμη σύνδεση), ο Client (jQuery/AJAX) χρησιμοποιεί τη μέθοδο του Polling:
Κάθε 2-3 δευτερόλεπτα, ο Client στέλνει αυτόματα ένα αίτημα GET /api/v1/games/{id}. Αυτό εξασφαλίζει ότι αν ο Παίκτης 1 κάνει μια κίνηση, ο Παίκτης 2 θα τη δει στην οθόνη του σχεδόν αμέσως. Όταν το API λάβει το αίτημα GET γίνεται URL Parsing: Το api.php αναγνωρίζει το game_id από το URL (π.χ. το "15" στο games/15).
Εκτελείται το query: SELECT * FROM games WHERE game_id = ?. Η στήλη board_state στη MySQL αποθηκεύει τα δεδομένα ως "JSON String". Η PHP χρησιμοποιεί τη συνάρτηση json_decode($row['board_state'], true) για να μετατρέψει το κείμενο πίσω σε PHP Array.
Τέλος το API προσθέτει στην απάντηση το current_turn και το status (waiting, active, ended) για να ξέρει ο Client αν πρέπει να επιτρέψει στον χρήστη να παίξει.

Στην εκτέλεση των κινήσεων γίνεται Verification: Το API ελέγχει το Bearer Token του παίκτη. Μόνο ο παίκτης που έχει σειρά (current_turn) επιτρέπεται να προχωρήσει. Ξεκινά με το Logic Processing κατά το οποίο καλείται η συνάρτηση apply_move_and_check_rules() η οποία:
1)Αφαιρεί την κάρτα από το χέρι του παίκτη.
2)Ελέγχει αν το τραπέζι "μαζεύεται" (ίδια αξία ή Βαλές).
3)Υπολογίζει αν δημιουργήθηκε "Ξερή".
Έπειτα το Atomic State Update. Η νέα κατάσταση του board μετατρέπεται ξανά σε JSON και αποθηκεύεται στη MySQL. Ταυτόχρονα, το πεδίο current_turn αλλάζει αυτόματα στο ID του επόμενου παίκτη.
Τέλος το Instant Feedback. Το API επιστρέφει τη νέα κατάσταση αμέσως μετά την κίνηση, ώστε ο παίκτης που έπαιξε να δει το αποτέλεσμα χωρίς να περιμένει το επόμενο poll.

Τεχνολογίες που χρησιμοποίθηκαν: 1) Authentication & Verification: Χρήση PHP για την εξαγωγή του Token από το HTTP Header και MySQL για την ταυτοποίηση του παίκτη στον πίνακα players.
                                 2) Logic Processing: Αποκλειστική χρήση PHP (Server-side logic) για την εφαρμογή των κανόνων της Ξερής, τη διαχείριση πινάκων (arrays) και τους μαθηματικούς υπολογισμούς των πόντων.
                                 3) State Storage: MySQL για την μόνιμη αποθήκευση της κατάστασης. Χρησιμοποιήθηκε ο τύπος δεδομένων TEXT για το board_state ώστε να υποστηρίζεται η σειριοποίηση (serialization).
                                 4) Data Exchange: JSON ως η μοναδική γλώσσα επικοινωνίας μεταξύ Frontend και Backend.
                                 5) Client Interaction: JavaScript (jQuery & AJAX) για την εκτέλεση των κινήσεων χωρίς ανανέωση της σελίδας και τη διαχείριση των απαντήσεων του API.

Κανόνες παιχνιδιού: https://www.i-cardgames.com/xeri-el/
